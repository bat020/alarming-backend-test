<html>
  <head>
    <link rel='stylesheet' href='style.css'>
    <script src='https://cdn.firebase.com/js/client/2.3.1/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
    <script src='alarmtest.js'></script>
  </head>
  <body>

    <h1>Alarming backend test</h1>

    <p id='login-status'>Login status goes here</p>

    <p><button id='logout-button'>log out</button></p>

    <p><input id='login-email' type='email' placeholder='login email' autofocus autocomplete='off'></p>
    <p><input id='login-password' type='password' placeholder='login password' autocomplete='off'></p>
    <p><button id='login-button'>log in</button></p>

    <p><input id='signup-email' type='email' placeholder='signup name' autocomplete='off'></p>
    <p><input id='signup-password' type='password' placeholder='signup password' autocomplete='off'></p>
    <p><button id='signup-button'>signup</button></p>

    <script>

      var ref = new Firebase('https://blazing-fire-4780.firebaseio.com/alarming');
      var usersRef = ref.child('users');
      var eventsRef = ref.child('events');

      ref.onAuth(authDataCallback);

      $('#login-button').click(function (){
        ref.authWithPassword({
          email: $('#login-email').val(),
          password: $('#login-password').val()
        }, authHandler);
      });

      $('#logout-button').click(function (){
        ref.unauth();
      });

      $('#signup-button').click(function (){
        ref.createUser({
          email: $('#signup-email').val(),
          password: $('#signup-password').val()
        }, function(error, userData) {
          if (error) {
            switch (error.code) {
              case "EMAIL_TAKEN":
                console.log("The new user account cannot be created because the email is already in use.");
                break;
              case "INVALID_EMAIL":
                console.log("The specified email is not a valid email.");
                break;
              default:
                console.log("Error creating user:", error);
            }
          } else {
            console.log("Successfully created user account with uid:", userData.uid);
            ref.authWithPassword({
              email: $('#signup-email').val(),
              password: $('#signup-password').val()
            }, authHandler);

          }
        });
      });



      function authDataCallback(authData) {
        if (authData) {
          $('#login-status').text(authData.uid + " is logged in with " + authData.provider);
        } else {
          $('#login-status').text("user is logged out");
        }
      }

      function authHandler(error, authData) {
        if (error) {
          console.log("Login Failed!", error);
        } else {
          console.log("Authenticated successfully with payload:", authData);
        }
      }

    </script>
  </body>
</html>
